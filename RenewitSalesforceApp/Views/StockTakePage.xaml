<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:RenewitSalesforceApp.Converters"
             x:Class="RenewitSalesforceApp.Views.StockTakePage"
             Title="Home Page"
             BackgroundColor="{AppThemeBinding Light=#f0f2f5, Dark=#121212}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:ConnectivityColorConverter x:Key="ConnectivityColorConverter"/>
            <converters:ConnectivityTextConverter x:Key="ConnectivityTextConverter"/>
            <converters:ConnectivityIconConverter x:Key="ConnectivityIconConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,Auto,*,Auto" Padding="20">

        <!-- Connectivity Status -->
        <Frame Grid.Row="0" 
               BackgroundColor="{Binding IsOfflineMode, Converter={StaticResource ConnectivityColorConverter}}"
               HasShadow="False"
               CornerRadius="15"
               HeightRequest="35"
               Padding="12,0"
               HorizontalOptions="Center"
               VerticalOptions="Start"
               Margin="0,5,0,10">
            <HorizontalStackLayout HorizontalOptions="Center" 
                                  Spacing="8" 
                                  VerticalOptions="Center">
                <!-- Connectivity Icon -->
                <Label Text="{Binding IsOfflineMode, Converter={StaticResource ConnectivityIconConverter}}"
                       FontFamily="MaterialIcons"
                       FontSize="16"
                       TextColor="White"
                       VerticalOptions="Center" />
                <!-- Status text -->
                <Label Text="{Binding IsOfflineMode, Converter={StaticResource ConnectivityTextConverter}}"
                       FontSize="13"
                       FontAttributes="Bold"
                       TextColor="White"
                       VerticalOptions="Center" />
            </HorizontalStackLayout>
        </Frame>

        <!-- Header -->
        <Grid Grid.Row="1" ColumnDefinitions="*" Margin="0,10,0,20">
            <!-- License Disk Scanner -->
            <VerticalStackLayout Grid.Column="0" Spacing="10" HorizontalOptions="Center">
                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#f0f0f0}"
                       BorderColor="{AppThemeBinding Light=#e0e0e0, Dark=#666666}"
                       CornerRadius="20"
                       Padding="15"
                       WidthRequest="75"
                       HeightRequest="75"
                       HorizontalOptions="Center"
                       HasShadow="True">
                    <Frame.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnLicenseDiskScanClicked"/>
                    </Frame.GestureRecognizers>
                    <Image Source="Images/barcode.png"
                           WidthRequest="40"
                           HeightRequest="40"
                           Aspect="AspectFit"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>
                </Frame>
                <Label Text="License Disk"
                       FontSize="13"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light=#333333, Dark=#f5f5f5}"
                       HorizontalOptions="Center"/>
                <Label Text="Scanner"
                       FontSize="13"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light=#333333, Dark=#f5f5f5}"
                       HorizontalOptions="Center"
                       Margin="0,-3,0,0"/>
            </VerticalStackLayout>
        </Grid>

        <!-- Main Form -->
        <ScrollView Grid.Row="2">
            <VerticalStackLayout Spacing="25">

                <!-- Item Identification Section -->
                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#1e1e1e}"
                       BorderColor="{AppThemeBinding Light=#e0e0e0, Dark=#333333}"
                       CornerRadius="12"
                       HasShadow="True"
                       Padding="25,20">
                    <VerticalStackLayout Spacing="18">
                        <Label Text="Item Identification"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#333333, Dark=#f5f5f5}"/>

                        <!-- Vehicle Registration -->
                        <VerticalStackLayout Spacing="5">
                            <StackLayout Orientation="Horizontal" Spacing="3">
                                <Label Text="Vehicle Registration"
                                       FontSize="14"
                                       TextColor="{AppThemeBinding Light=#666666, Dark=#aaaaaa}"/>
                                <Label Text="*" 
                                       FontSize="14" 
                                       TextColor="Red" 
                                       IsVisible="{Binding DiscRegRequired}"/>
                            </StackLayout>
                            <Entry x:Name="VehicleRegEntry"
                                   Placeholder="Enter vehicle registration"
                                   BackgroundColor="{AppThemeBinding Light=#f7f8fa, Dark=#2a2a2a}"
                                   TextColor="{AppThemeBinding Light=#333333, Dark=#f5f5f5}"/>
                        </VerticalStackLayout>

                        <!-- Full Barcode Data (DISC_REG) -->
                        <VerticalStackLayout Spacing="5">
                            <Label Text="License Disk Barcode (DISC_REG)"
                                   FontSize="14"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#aaaaaa}"/>
                            <Entry x:Name="DiscRegEntry"
                                   Placeholder="Full barcode data from scan"
                                   IsReadOnly="True"
                                   BackgroundColor="{AppThemeBinding Light=#f0f0f0, Dark=#1a1a1a}"
                                   TextColor="{AppThemeBinding Light=#555555, Dark=#cccccc}"/>
                        </VerticalStackLayout>

                        <!-- License Number -->
                        <VerticalStackLayout Spacing="5">
                            <Label Text="License Number"
                                   FontSize="14"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#aaaaaa}"/>
                            <Entry x:Name="LicenseEntry"
                                   Placeholder="Enter license number"
                                   BackgroundColor="{AppThemeBinding Light=#f7f8fa, Dark=#2a2a2a}"
                                   TextColor="{AppThemeBinding Light=#333333, Dark=#f5f5f5}"/>
                        </VerticalStackLayout>

                        <!-- Reference ID -->
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Reference ID"
                                   FontSize="14"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#aaaaaa}"/>
                            <Entry x:Name="RefIdEntry"
                                   Placeholder="Enter reference ID"
                                   BackgroundColor="{AppThemeBinding Light=#f7f8fa, Dark=#2a2a2a}"
                                   TextColor="{AppThemeBinding Light=#333333, Dark=#f5f5f5}"/>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Frame>

                <!-- Vehicle Details Section -->
                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#1e1e1e}"
                       BorderColor="{AppThemeBinding Light=#e0e0e0, Dark=#333333}"
                       CornerRadius="12"
                       HasShadow="True"
                       Padding="25,20">
                    <VerticalStackLayout Spacing="18">
                        <StackLayout Orientation="Horizontal" Spacing="5">
                            <Label Text="Vehicle Details"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#333333, Dark=#f5f5f5}"
                                   VerticalOptions="Center"/>
                            <Label Text="(populated from scan)"
                                   FontSize="12"
                                   FontAttributes="Italic"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#aaaaaa}"
                                   VerticalOptions="Center"/>
                        </StackLayout>

                        <!-- Make -->
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Make"
                                   FontSize="14"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#aaaaaa}"/>
                            <Entry x:Name="MakeEntry"
                                   Placeholder="Scanned from license disk"
                                   IsReadOnly="True"
                                   BackgroundColor="{AppThemeBinding Light=#f0f0f0, Dark=#1a1a1a}"
                                   TextColor="{AppThemeBinding Light=#555555, Dark=#cccccc}"/>
                        </VerticalStackLayout>

                        <!-- Model -->
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Model"
                                   FontSize="14"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#aaaaaa}"/>
                            <Entry x:Name="ModelEntry"
                                   Placeholder="Scanned from license disk"
                                   IsReadOnly="True"
                                   BackgroundColor="{AppThemeBinding Light=#f0f0f0, Dark=#1a1a1a}"
                                   TextColor="{AppThemeBinding Light=#555555, Dark=#cccccc}"/>
                        </VerticalStackLayout>

                        <!-- Colour -->
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Colour"
                                   FontSize="14"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#aaaaaa}"/>
                            <Entry x:Name="ColourEntry"
                                   Placeholder="Scanned from license disk"
                                   IsReadOnly="True"
                                   BackgroundColor="{AppThemeBinding Light=#f0f0f0, Dark=#1a1a1a}"
                                   TextColor="{AppThemeBinding Light=#555555, Dark=#cccccc}"/>
                        </VerticalStackLayout>

                        <!-- Vehicle Type -->
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Vehicle Type"
                                   FontSize="14"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#aaaaaa}"/>
                            <Entry x:Name="VehicleTypeEntry"
                                   Placeholder="Scanned from license disk"
                                   IsReadOnly="True"
                                   BackgroundColor="{AppThemeBinding Light=#f0f0f0, Dark=#1a1a1a}"
                                   TextColor="{AppThemeBinding Light=#555555, Dark=#cccccc}"/>
                        </VerticalStackLayout>

                        <!-- VIN Number -->
                        <VerticalStackLayout Spacing="5">
                            <Label Text="VIN Number"
                                   FontSize="14"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#aaaaaa}"/>
                            <Entry x:Name="VinEntry"
                                   Placeholder="Scanned from license disk"
                                   IsReadOnly="True"
                                   BackgroundColor="{AppThemeBinding Light=#f0f0f0, Dark=#1a1a1a}"
                                   TextColor="{AppThemeBinding Light=#555555, Dark=#cccccc}"/>
                        </VerticalStackLayout>

                        <!-- Engine Number -->
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Engine Number"
                                   FontSize="14"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#aaaaaa}"/>
                            <Entry x:Name="EngineEntry"
                                   Placeholder="Scanned from license disk"
                                   IsReadOnly="True"
                                   BackgroundColor="{AppThemeBinding Light=#f0f0f0, Dark=#1a1a1a}"
                                   TextColor="{AppThemeBinding Light=#555555, Dark=#cccccc}"/>
                        </VerticalStackLayout>

                        <!-- License Expiry Date -->
                        <VerticalStackLayout Spacing="5">
                            <Label Text="License Expiry Date"
                                   FontSize="14"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#aaaaaa}"/>
                            <Entry x:Name="ExpiryDateEntry"
                                   Placeholder="Scanned from license disk"
                                   IsReadOnly="True"
                                   BackgroundColor="{AppThemeBinding Light=#f0f0f0, Dark=#1a1a1a}"
                                   TextColor="{AppThemeBinding Light=#555555, Dark=#cccccc}"/>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Frame>

                <!-- Location Section -->
                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#1e1e1e}"
                       BorderColor="{AppThemeBinding Light=#e0e0e0, Dark=#333333}"
                       CornerRadius="12"
                       HasShadow="True"
                       Padding="25,20">
                    <VerticalStackLayout Spacing="18">
                        <Label Text="Location"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#333333, Dark=#f5f5f5}"/>

                        <!-- Yard (Branch) -->
                        <VerticalStackLayout Spacing="5">
                            <StackLayout Orientation="Horizontal" Spacing="3">
                                <Label Text="Branch"
                                       FontSize="14"
                                       TextColor="{AppThemeBinding Light=#666666, Dark=#aaaaaa}"/>
                                <Label Text="*" 
                                       FontSize="14" 
                                       TextColor="Red" 
                                       IsVisible="{Binding YardRequired}"/>
                            </StackLayout>
                            <Picker x:Name="YardPicker"
                                    Title="Select the branch"
                                    BackgroundColor="{AppThemeBinding Light=#f7f8fa, Dark=#2a2a2a}"
                                    TextColor="{AppThemeBinding Light=#333333, Dark=#f5f5f5}"/>
                        </VerticalStackLayout>

                        <!-- Yard Location -->
                        <VerticalStackLayout Spacing="5">
                            <StackLayout Orientation="Horizontal" Spacing="3">
                                <Label Text="Department"
                                       FontSize="14"
                                       TextColor="{AppThemeBinding Light=#666666, Dark=#aaaaaa}"/>
                                <Label Text="*" 
                                       FontSize="14" 
                                       TextColor="Red" 
                                       IsVisible="{Binding YardLocationRequired}"/>
                            </StackLayout>
                            <Picker x:Name="YardLocationPicker"
                                    Title="Select the department"
                                    BackgroundColor="{AppThemeBinding Light=#f7f8fa, Dark=#2a2a2a}"
                                    TextColor="{AppThemeBinding Light=#333333, Dark=#f5f5f5}"/>
                        </VerticalStackLayout>

                        <!-- GPS Coordinates -->
                        <VerticalStackLayout Spacing="5">
                            <Label Text="GPS Coordinates"
                                   FontSize="14"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#aaaaaa}"/>
                            <Frame BackgroundColor="{AppThemeBinding Light=#f7f8fa, Dark=#2a2a2a}"
                                   BorderColor="{AppThemeBinding Light=#e2e8f0, Dark=#3a3a3a}"
                                   CornerRadius="8"
                                   Padding="10">
                                <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="5">
                                    <Label Grid.Column="0"
                                           x:Name="GpsLabel"
                                           Text="Getting current location..."
                                           FontSize="14"
                                           TextColor="{AppThemeBinding Light=#666666, Dark=#aaaaaa}"
                                           VerticalOptions="Center"/>
                                    <!-- Map Preview Pin -->
                                    <Button Grid.Column="1"
                                            x:Name="MapPreviewButton"
                                            Text="&#xe55f;"
                                            FontFamily="MaterialIcons"
                                            FontSize="18"
                                            TextColor="#FF6B35"
                                            BackgroundColor="Transparent"
                                            Clicked="OnMapPreviewClicked"
                                            WidthRequest="35"
                                            HeightRequest="35"
                                            Padding="0"
                                            Margin="0"
                                            IsVisible="False"/>
                                    <!-- Get Location Button -->
                                    <Button Grid.Column="2"
                                            Text="&#xe55c;"
                                            FontFamily="MaterialIcons"
                                            FontSize="18"
                                            TextColor="#007AFF"
                                            BackgroundColor="Transparent"
                                            Clicked="OnGetLocationClicked"
                                            WidthRequest="35"
                                            HeightRequest="35"
                                            Padding="0"
                                            Margin="0"/>
                                </Grid>
                            </Frame>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Frame>

                <!-- Photos Section -->
                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#1e1e1e}"
                       BorderColor="{AppThemeBinding Light=#e0e0e0, Dark=#333333}"
                       CornerRadius="12"
                       HasShadow="True"
                       Padding="25,20">
                    <VerticalStackLayout Spacing="18">
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="5">
                            <Label Grid.Column="0"
                                   Text="Photos"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#333333, Dark=#f5f5f5}"
                                   VerticalOptions="Center"/>
                            <Button Grid.Column="1"
                                    Text="&#xe3b0;"
                                    FontFamily="MaterialIcons"
                                    FontSize="20"
                                    TextColor="#007AFF"
                                    BackgroundColor="Transparent"
                                    Clicked="OnTakePhotoClicked"
                                    WidthRequest="35"
                                    HeightRequest="35"
                                    Padding="0"
                                    Margin="0"/>
                        </Grid>

                        <!-- Photo Preview Area -->
                        <Frame x:Name="PhotoFrame"
                               BackgroundColor="{AppThemeBinding Light=#f7f8fa, Dark=#2a2a2a}"
                               BorderColor="{AppThemeBinding Light=#e2e8f0, Dark=#3a3a3a}"
                               CornerRadius="8"
                               HeightRequest="120"
                               IsVisible="False">
                            <Grid>
                                <Image x:Name="PhotoPreview"
                                       Aspect="AspectFit"/>
                                <Frame BackgroundColor="Black"
                                       CornerRadius="10"
                                       Padding="8,4"
                                       HasShadow="False"
                                       HorizontalOptions="End"
                                       VerticalOptions="Start"
                                       Margin="10">
                                    <Label x:Name="PhotoCountLabel"
                                           Text="1 photo"
                                           TextColor="White"
                                           FontSize="12"/>
                                </Frame>
                            </Grid>
                        </Frame>

                        <!-- No Photos Placeholder -->
                        <Frame x:Name="NoPhotoFrame"
                               BackgroundColor="{AppThemeBinding Light=#f7f8fa, Dark=#2a2a2a}"
                               BorderColor="{AppThemeBinding Light=#e2e8f0, Dark=#3a3a3a}"
                               CornerRadius="8"
                               HeightRequest="120">
                            <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="10">
                                <Label Text="&#xe3b0;"
                                       FontFamily="MaterialIcons"
                                       FontSize="40"
                                       TextColor="{AppThemeBinding Light=#cccccc, Dark=#555555}"
                                       HorizontalOptions="Center"/>
                                <Label Text="No photos taken"
                                       FontSize="14"
                                       TextColor="{AppThemeBinding Light=#666666, Dark=#aaaaaa}"
                                       HorizontalOptions="Center"/>
                            </VerticalStackLayout>
                        </Frame>
                    </VerticalStackLayout>
                </Frame>

                <!-- Notes Section -->
                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#1e1e1e}"
                       BorderColor="{AppThemeBinding Light=#e0e0e0, Dark=#333333}"
                       CornerRadius="12"
                       HasShadow="True"
                       Padding="25,20">
                    <VerticalStackLayout Spacing="18">
                        <Label Text="Comments"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#333333, Dark=#f5f5f5}"/>

                        <Editor x:Name="CommentsEditor"
                                Placeholder="Add any comments or notes..."
                                HeightRequest="100"
                                BackgroundColor="{AppThemeBinding Light=#f7f8fa, Dark=#2a2a2a}"
                                TextColor="{AppThemeBinding Light=#333333, Dark=#f5f5f5}"/>
                    </VerticalStackLayout>
                </Frame>

            </VerticalStackLayout>
        </ScrollView>

        <!-- Submit Button -->
        <Grid Grid.Row="3" Margin="0,30,0,15">
            <Button x:Name="SubmitButton"
                    Text="SUBMIT STOCK TAKE"
                    BackgroundColor="#28a745"
                    TextColor="White"
                    FontAttributes="Bold"
                    FontSize="16"
                    CornerRadius="28"
                    HeightRequest="56"
                    Clicked="OnSubmitClicked"/>
        </Grid>
    </Grid>
</ContentPage>